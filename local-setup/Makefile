# Blog Management System - Local Development

.PHONY: help setup start stop clean build test logs

# ê¸°ë³¸ íƒ€ê²Ÿ
help: ## ë„ì›€ë§ í‘œì‹œ
	@echo "ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "   \033[36m%-15s\033[0m %s\n", $$1, $$2}'

setup: ## ë¡œì»¬ ê°œë°œ í™˜ê²½ ì „ì²´ ì„¤ì • (ìµœì´ˆ ì‹¤í–‰)
	@echo "ğŸš€ ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì • ì¤‘..."
	./setup_local.sh

start: ## DynamoDB Local ì„œë¹„ìŠ¤ ì‹œì‘
	@echo "â–¶ï¸  DynamoDB Local ì‹œì‘ ì¤‘..."
	docker-compose up -d
	@echo "âœ… ì„œë¹„ìŠ¤ ì‹œì‘ ì™„ë£Œ"
	@echo "   ğŸ—„ï¸  DynamoDB Local: http://localhost:8000"
	@echo "   ğŸ–¥ï¸  DynamoDB Admin: http://localhost:8001"

stop: ## DynamoDB Local ì„œë¹„ìŠ¤ ì¤‘ì§€
	@echo "â¹ï¸  DynamoDB Local ì¤‘ì§€ ì¤‘..."
	docker-compose down
	@echo "âœ… ì„œë¹„ìŠ¤ ì¤‘ì§€ ì™„ë£Œ"

clean: ## ëª¨ë“  ì»¨í…Œì´ë„ˆ ë° ë³¼ë¥¨ ì‚­ì œ (ë°ì´í„° ì´ˆê¸°í™”)
	@echo "ğŸ§¹ ë°ì´í„° ì •ë¦¬ ì¤‘..."
	docker-compose down -v --remove-orphans
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ"

build: ## SAM ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
	@echo "ğŸ”¨ SAM ë¹Œë“œ ì¤‘..."
	cd .. && sam build
	@echo "âœ… ë¹Œë“œ ì™„ë£Œ"

run: build ## SAM Local API ì‹¤í–‰
	@echo "ğŸš€ SAM Local API ì‹œì‘ ì¤‘..."
	@echo "   API ì—”ë“œí¬ì¸íŠ¸: http://localhost:3000"
	cd .. && sam local start-api --env-vars env.json

test: ## API í…ŒìŠ¤íŠ¸ ì‹¤í–‰
	@echo "ğŸ§ª API í…ŒìŠ¤íŠ¸ ì¤‘..."
	@echo "ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ:"
	@curl -s http://localhost:3000/board | jq . || echo "âŒ APIê°€ ì‹¤í–‰ë˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. 'make run'ìœ¼ë¡œ APIë¥¼ ì‹œì‘í•˜ì„¸ìš”."

logs: ## ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
	@echo "ğŸ“‹ ì»¨í…Œì´ë„ˆ ë¡œê·¸:"
	docker-compose logs -f

status: ## ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
	@echo "ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœ:"
	@docker-compose ps
	@echo ""
	@echo "ğŸ”— ì„œë¹„ìŠ¤ URL:"
	@echo "   DynamoDB Local: http://localhost:8000"
	@echo "   DynamoDB Admin: http://localhost:8001"
	@echo "   SAM Local API: http://localhost:3000 (ì‹¤í–‰ ì¤‘ì¸ ê²½ìš°)"

install-deps: ## ê°œë°œ ì˜ì¡´ì„± ì„¤ì¹˜
	@echo "ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
	@if [ ! -d "../venv" ]; then cd .. && python3 -m venv venv; fi
	@cd .. && source venv/bin/activate && pip install boto3
	@echo "âœ… ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"

create-table: install-deps ## DynamoDB í…Œì´ë¸” ì¬ìƒì„±
	@echo "ğŸ“Š DynamoDB í…Œì´ë¸” ìƒì„± ì¤‘..."
	@cd .. && source venv/bin/activate && python3 local-setup/setup_local_table.py
	@echo "âœ… í…Œì´ë¸” ìƒì„± ì™„ë£Œ"

# ê°œë°œ ì›Œí¬í”Œë¡œìš° ë‹¨ì¶•í‚¤
dev: setup build run ## ì „ì²´ ê°œë°œ í™˜ê²½ ì„¤ì • ë° ì‹¤í–‰

quick-start: start build run ## ë¹ ë¥¸ ì‹œì‘ (ì„¤ì • ì™„ë£Œëœ ê²½ìš°)
